<div class="bg-shape shape-1"></div>
<div class="bg-shape shape-2"></div>
<div class="bg-shape shape-3"></div>

<div class="card-container">
  <div class="card-register">
    <!-- Logo -->
    <div class="logo-container">
      <div class="logo-icon">
        <i class="bi bi-person-plus-fill"></i>
      </div>
      <h1 class="title">Crear Cuenta</h1>
      <p class="subtitle">Únete a TaskFlow y organiza tus tareas</p>
    </div>

    <!-- Alertas -->
    @if (successMessage()) {
      <div class="alert alert-success">
        <i class="bi bi-check-circle-fill me-2"></i>
        <span>{{ successMessage() }}</span>
      </div>
    }

    @if (errorMessage()) {
      <div class="alert alert-danger">
        <i class="bi bi-exclamation-circle-fill me-2"></i>
        <span>{{ errorMessage() }}</span>
      </div>
    }

    <!-- Formulario -->
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <!-- Nombre -->
      <div class="form-floating mb-3">
        <i class="bi bi-person-fill input-icon"></i>
        <input 
          type="text" 
          class="form-control" 
          id="nombre" 
          formControlName="nombre" 
          placeholder="Nombre completo"
          maxlength="100"
          [class.is-invalid]="isFieldInvalid('nombre')">
        <label for="nombre">Nombre completo</label>
        @if (isFieldInvalid('nombre')) {
          <div class="invalid-feedback">{{ getFieldError('nombre') }}</div>
        }
        <small class="form-hint">Solo letras permitidas</small>
      </div>

      <!-- Username -->
      <div class="form-floating mb-3">
        <i class="bi bi-at input-icon"></i>
        <input 
          type="text" 
          class="form-control" 
          id="username" 
          formControlName="username" 
          placeholder="Usuario"
          maxlength="50"
          [class.is-invalid]="isFieldInvalid('username')">
        <label for="username">Nombre de usuario</label>
        @if (isFieldInvalid('username')) {
          <div class="invalid-feedback">{{ getFieldError('username') }}</div>
        }
        <small class="form-hint">Debe comenzar con letra. Solo letras, números y _</small>
      </div>

      <!-- Email -->
      <div class="form-floating mb-3">
        <i class="bi bi-envelope-fill input-icon"></i>
        <input 
          type="email" 
          class="form-control" 
          id="email" 
          formControlName="email" 
          placeholder="Correo electrónico"
          [class.is-invalid]="isFieldInvalid('email')">
        <label for="email">Correo electrónico</label>
        @if (isFieldInvalid('email')) {
          <div class="invalid-feedback">{{ getFieldError('email') }}</div>
        }
      </div>

      <!-- Password -->
      <div class="form-floating mb-2 position-relative">
        <i class="bi bi-lock-fill input-icon"></i>
        <input 
          [type]="showPassword() ? 'text' : 'password'" 
          class="form-control" 
          id="password" 
          formControlName="password" 
          placeholder="Contraseña"
          [class.is-invalid]="isFieldInvalid('password')">
        <label for="password">Contraseña</label>
        <i 
          class="bi password-toggle" 
          [class.bi-eye-fill]="!showPassword()" 
          [class.bi-eye-slash-fill]="showPassword()" 
          (click)="togglePassword()">
        </i>
        @if (isFieldInvalid('password')) {
          <div class="invalid-feedback">{{ getFieldError('password') }}</div>
        }
      </div>

      <!-- Password Strength Indicator -->
      @if (registerForm.get('password')?.value) {
        <div class="password-strength mb-3">
          <div class="strength-bars">
            <div 
              class="strength-bar" 
              [class.active]="passwordStrength().level >= 1"
              [style.background-color]="passwordStrength().level >= 1 ? passwordStrength().color : '#e9ecef'">
            </div>
            <div 
              class="strength-bar" 
              [class.active]="passwordStrength().level >= 2"
              [style.background-color]="passwordStrength().level >= 2 ? passwordStrength().color : '#e9ecef'">
            </div>
            <div 
              class="strength-bar" 
              [class.active]="passwordStrength().level >= 3"
              [style.background-color]="passwordStrength().level >= 3 ? passwordStrength().color : '#e9ecef'">
            </div>
          </div>
          <span class="strength-text" [style.color]="passwordStrength().color">
            {{ passwordStrength().text }}
          </span>
        </div>
      }

      <small class="text-muted d-block mb-3">
        Mínimo 6 caracteres. Usa mayúsculas, números y símbolos para mayor seguridad.
      </small>

      <!-- Submit button -->
      <button type="submit" class="btn-primary-custom" [disabled]="loading()">
        @if (loading()) {
          <span class="spinner-border spinner-border-sm me-2"></span>
          Creando cuenta...
        } @else {
          <i class="bi bi-person-plus me-2"></i>
          Crear Cuenta
        }
      </button>
    </form>

    <!-- Login link -->
    <div class="login-link">
      <span>¿Ya tienes cuenta?</span>
      <a routerLink="/auth/login">Inicia sesión aquí</a>
    </div>
  </div>
</div>