<div class="bg-shape shape-1"></div>
<div class="bg-shape shape-2"></div>

<div class="card-container">
  <div class="card-forgot">
    @if (!emailSent()) {
      <div class="logo-container">
        <div class="logo-icon">
          <i class="bi bi-envelope-paper-fill"></i>
        </div>
        <h1 class="title">¿Olvidaste tu contraseña?</h1>
        <p class="subtitle">Ingresa tu correo y te enviaremos un enlace para restablecerla.</p>
      </div>

      @if (errorMessage()) {
        <div class="alert alert-danger">
          <i class="bi bi-exclamation-circle-fill me-2"></i>
          <span>{{ errorMessage() }}</span>
        </div>
      }

      <form [formGroup]="forgotForm" (ngSubmit)="onSubmit()">
        <div class="form-floating mb-4">
          <i class="bi bi-envelope-fill input-icon"></i>
          <input 
            type="email" 
            class="form-control" 
            id="email" 
            formControlName="email" 
            placeholder="Correo electrónico"
            [class.is-invalid]="isFieldInvalid('email')">
          <label for="email">Correo electrónico</label>
          @if (isFieldInvalid('email')) {
            <div class="invalid-feedback">Ingresa un correo válido</div>
          }
        </div>

        <button type="submit" class="btn-primary-custom" [disabled]="loading()">
          @if (loading()) {
            <span class="spinner-border spinner-border-sm me-2"></span>
            Enviando...
          } @else {
            <i class="bi bi-send-fill me-2"></i>
            Enviar enlace
          }
        </button>
      </form>

      <div class="back-link">
        <a routerLink="/auth/login">
          <i class="bi bi-arrow-left me-1"></i>
          Volver al inicio de sesión
        </a>
      </div>
    }

    <!-- Vista de éxito: email enviado -->
    @if (emailSent()) {
      <div class="success-container">
        <div class="success-icon">
          <i class="bi bi-envelope-check-fill"></i>
        </div>
        <h1 class="title">¡Correo enviado!</h1>
        <p class="subtitle">{{ successMessage() }}</p>
        <p class="email-sent-to">
          <i class="bi bi-at"></i>
          {{ forgotForm.value.email }}
        </p>

        <div class="info-box">
          <i class="bi bi-info-circle-fill"></i>
          <p>Revisa tu bandeja de entrada y spam. El enlace expira en 24 horas.</p>
        </div>

        <div class="action-buttons">
          <a routerLink="/auth/login" class="btn-primary-custom">
            <i class="bi bi-box-arrow-in-right me-2"></i>
            Ir al login
          </a>
          <button type="button" class="btn-secondary-custom" (click)="resetForm()">
            <i class="bi bi-arrow-repeat me-2"></i>
            Enviar a otro correo
          </button>
        </div>
      </div>
    }
  </div>
</div>