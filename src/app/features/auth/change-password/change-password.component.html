<div class="bg-shape shape-1"></div>
<div class="bg-shape shape-2"></div>

<div class="card-container">
  <div class="card-change">
    <!-- Header con usuario -->
    <div class="header-section">
      <div class="logo-container">
        <div class="logo-icon">
          <i class="bi bi-shield-lock-fill"></i>
        </div>
        <h1 class="title">Cambiar contraseña</h1>
        <p class="subtitle">Actualiza la contraseña de tu cuenta</p>
      </div>
      
      <div class="user-badge">
        <i class="bi bi-person-circle"></i>
        <span>{{ username }}</span>
      </div>
    </div>

    @if (successMessage()) {
      <div class="alert alert-success">
        <i class="bi bi-check-circle-fill me-2"></i>
        <span>{{ successMessage() }}</span>
      </div>
    }

    @if (errorMessage()) {
      <div class="alert alert-danger">
        <i class="bi bi-exclamation-circle-fill me-2"></i>
        <span>{{ errorMessage() }}</span>
      </div>
    }

    <form [formGroup]="changeForm" (ngSubmit)="onSubmit()">

      <div class="form-floating mb-3 position-relative">
        <i class="bi bi-lock-fill input-icon"></i>
        <input 
          [type]="showPassword() ? 'text' : 'password'" 
          class="form-control" 
          id="newPassword" 
          formControlName="newPassword" 
          placeholder="Nueva contraseña"
          [class.is-invalid]="isFieldInvalid('newPassword')">
        <label for="newPassword">Nueva contraseña</label>
        <i 
          class="bi password-toggle" 
          [class.bi-eye-fill]="!showPassword()" 
          [class.bi-eye-slash-fill]="showPassword()" 
          (click)="togglePassword()">
        </i>
        @if (isFieldInvalid('newPassword')) {
          <div class="invalid-feedback">Mínimo 6 caracteres</div>
        }
      </div>

      <!-- Confirmar contraseña -->
      <div class="form-floating mb-3 position-relative">
        <i class="bi bi-lock-fill input-icon"></i>
        <input 
          [type]="showConfirmPassword() ? 'text' : 'password'" 
          class="form-control" 
          id="confirmPassword" 
          formControlName="confirmPassword" 
          placeholder="Confirmar contraseña"
          [class.is-invalid]="passwordMismatch()">
        <label for="confirmPassword">Confirmar contraseña</label>
        <i 
          class="bi password-toggle" 
          [class.bi-eye-fill]="!showConfirmPassword()" 
          [class.bi-eye-slash-fill]="showConfirmPassword()" 
          (click)="toggleConfirmPassword()">
        </i>
        @if (passwordMismatch()) {
          <div class="invalid-feedback d-block">Las contraseñas no coinciden</div>
        }
      </div>

      <small class="text-muted d-block mb-3">
        <i class="bi bi-info-circle me-1"></i>
        Mínimo 6 caracteres. Usa mayúsculas, números y símbolos para mayor seguridad.
      </small>

      <button type="submit" class="btn-primary-custom" [disabled]="loading()">
        @if (loading()) {
          <span class="spinner-border spinner-border-sm me-2"></span>
          Guardando...
        } @else {
          <i class="bi bi-check-circle me-2"></i>
          Guardar nueva contraseña
        }
      </button>
    </form>

    <div class="nav-links">
      <a routerLink="/tareas">
        <i class="bi bi-arrow-left me-1"></i>
        Volver a mis tareas
      </a>
      <a (click)="logout()" class="logout-link">
        <i class="bi bi-box-arrow-right me-1"></i>
        Cerrar sesión
      </a>
    </div>
  </div>
</div>